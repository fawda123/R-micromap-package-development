---
output:
  html_document:
    keep_md: yes
    toc: no
    self_contained: no
  pdf_document:
    toc: yes
---

# R-micromap-package-development

[![Downloads from the RStudio CRAN mirror](http://cranlogs.r-pkg.org/badges/grand-total/micromap)](http://cran.rstudio.com/package=micromap) [![AppVeyor Build Status](http://ci.appveyor.com/api/projects/status/github/fawda123/R-micromap-package-development?branch=development)](http://ci.appveyor.com/project/fawda123/R-micromap-package-development)

This repository is for development of the USEPA R micromap package.   If you would like to contribute to this repository please follow the guidelines in [CONTRIBUTING](CONTRIBUTING.md).

### Installing the package

Version 1.9.2 is the stable version on CRAN and can be installed as follows.

```{r eval = F}
# install from CRAN
install.packages('micromap')
library(micromap)
```

The development version can be installed from the development branch on the repository.

```{r eval = F}
# requires devools to install
install.packages('devtools')
library(devtools)

# install from repo
install_github('USEPA/R-micromap-package-development', ref = 'development')
library(micromap)
```

### Citation

```{r}
citation(package = 'micromap')
```

### Using the functions

Please consult the [publication](http://www.jstatsoft.org/v63/i02/) in the Journal of Statistical Software for a general overview of the package.  A vignette is also provided with the development version of the package:

```{r eval = F}
# view vignette
vignette(package = 'micromap')

# open vignette
vignette('Introduction_Guide')
```

The following provides minimal working examples to illustrate functionality provided by the micromap package.

```{r message = F, warning = F, echo = F}
devtools::load_all()
```
```{r, fig.height = 6, fig.width = 12}
# stat data, data.frame
data('edPov')

# map data
data("USstates") 
statePolys <- create_map_table(USstates, IDcolumn="ST") 

##
# standard
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "point","point", "map"),
  panel.data=list("state","pov","ed", NA),
  ord.by="pov", grouping=17,
  map.link=c("StateAb","ID"),
  flip = F
)
```

The updated version of the micromap package includes additional ggplot2 geoms for plotting.  The use of appropriate geoms depends on the type of data relationships that can be displayed.  The two most common data relationships are nominal data, such as values by categories, or bivariate relationships, such as standard x/y variable plots.  The geoms in ggplot2 that can be used with micromap are specified in the `panel.types` argument in the `mmplot` or `mmgroupedplot` functions, e.g., `panel.types = c('labels', 'geom_point', 'geom_bar', 'map')`.  The geom can be specified as a character string by the full geom or by ommitting the `'geom_'` text, i.e., `'geom_point'` or `'point'`.

Appropriate geoms for nominal data relationships include:

* `geom_point`

```{r, fig.height = 6, fig.width = 12, out.width = '500px', echo = F}
# point
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "point","point", "map"),
  panel.data=list("state","pov","ed", NA),
  ord.by="pov", grouping=17,
  map.link=c("StateAb","ID")
)
```

* `geom_bar`

```{r, fig.height = 6, fig.width = 12, out.width = '500px', echo = F}
# bar
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "bar", "bar", "map"),
  panel.data=list("state","pov","ed", NA),
  ord.by="pov", grouping=17,
  map.link=c("StateAb","ID")
)
```

* `geom_jitter`

```{r, fig.height = 6, fig.width = 12, out.width = '500px', echo = F}
# bar
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "jitter", "jitter", "map"),
  panel.data=list("state","pov","ed", NA),
  ord.by="pov", grouping=17,
  map.link=c("StateAb","ID")
)
```

* `geom_label`

```{r, fig.height = 6, fig.width = 12, out.width = '500px', echo = F}
# bar
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "label", "label", "map"),
  panel.data=list("state","pov","ed", NA),
  ord.by="pov", grouping=17,
  map.link=c("StateAb","ID")
)
```

* `geom_line`

```{r, fig.height = 6, fig.width = 12, out.width = '500px', echo = F}
# bar
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "line", "line", "map"),
  panel.data=list("state","pov","ed", NA),
  ord.by="pov", grouping=17,
  map.link=c("StateAb","ID")
)
```

* `geom_step`

```{r, fig.height = 6, fig.width = 12, out.width = '500px', echo = F}
# bar
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "step", "step", "map"),
  panel.data=list("state","pov","ed", NA),
  ord.by="pov", grouping=17,
  map.link=c("StateAb","ID")
)
```

* `geom_text`

```{r, fig.height = 6, fig.width = 12, out.width = '500px', echo = F}
# bar
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "text", "text", "map"),
  panel.data=list("state","pov","ed", NA),
  ord.by="pov", grouping=17,
  map.link=c("StateAb","ID")
)
```

Bivariate plotting in the micromap package is possible by addiing additional variable names to the `panel.data` argument and using an appropriate geom in the `panel.types` argument.  For example, `panel.types=c("labels", "point", "map")` and `panel.data = list("state", c("pov", "ed"), NA)` will produce a scatterplot of poverty  (x) by education (y).  

Appropriate geoms for bivariate relationships include:

* `geom_point`

```{r, fig.height = 6, fig.width = 10, out.width = '450px', echo = F}
# geom_point
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "point", "map"),
  panel.data=list("state", c("pov", "ed"), NA),
  ord.by="ed", grouping=17,
  map.link=c("StateAb","ID")
)
```

* `geom_bin2d` number of observations defined by bins in two-dimensions

```{r, fig.height = 6, fig.width = 10, out.width = '450px', echo = F}
# geom_point
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "bin2d", "map"),
  panel.data=list("state", c("pov", "ed"), NA),
  ord.by="ed", grouping=17,
  map.link=c("StateAb","ID")
)
```

* `geom_count` number or proportion of observations defined by all combinations in two-dimensions

```{r, fig.height = 6, fig.width = 10, out.width = '450px', echo = F}
# count
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "count", "map"),
  panel.data=list("state", c("pov", "ed"), NA),
  ord.by="ed", grouping=17,
  map.link=c("StateAb","ID")
)
```

* `geom_density_2d`

```{r, fig.height = 6, fig.width = 10, out.width = '450px', echo = F}
# density_2d
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "density_2d", "map"),
  panel.data=list("state", c("pov", "ed"), NA),
  ord.by="ed", grouping=17,
  map.link=c("StateAb","ID")
)
```

* `geom_hex` Same as `bin2d` but two-dimensional locations are shown as hexagons

```{r, fig.height = 6, fig.width = 10, out.width = '450px', echo = F}
# hex
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "hex", "map"),
  panel.data=list("state", c("pov", "ed"), NA),
  ord.by="ed", grouping=17,
  map.link=c("StateAb","ID")
)
```

* `geom_path` 

```{r, fig.height = 6, fig.width = 10, out.width = '450px', echo = F}
# hex
mmplot(stat.data=edPov, map.data=statePolys,
  panel.types=c("labels", "path", "map"),
  panel.data=list("state", c("pov", "ed"), NA),
  ord.by="ed", grouping=17,
  map.link=c("StateAb","ID")
)
```

### EPA Disclaimer

The United States Environmental Protection Agency (EPA) GitHub project code is provided on an "as is" basis and the user assumes responsibility for its use. EPA has relinquished control of the information and no longer has responsibility to protect the integrity , confidentiality, or availability of the information. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recomendation or favoring by EPA. The EPA seal and logo shall not be used in any manner to imply endorsement of any commercial product or activity by EPA or the United States Government.

By submitting a pull request, you make an agreement with EPA that you will not submit a claim of compensation for services rendered to EPA or any other federal agency.  Further, you agree not to charge the time you spend developing software code related to this project to any federal grant or cooperative agreement.

### License

This project is licensed under the GNU General Public License, [GPL-2](http://cran.r-project.org/web/licenses/GPL-2). 
